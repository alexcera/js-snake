/*!snake 15-07-2014 */
window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),function(a){var b=!1,c=20,d="#0D0D0D",e="#002608",f=0,g=a.Game=function(){return!this instanceof arguments.callee?new g:void 0};return g.prototype.FPS=50,g.prototype.start=function(){b=!0},g.prototype.pause=function(){b=!1},g.prototype.blockSize=function(){return c},g.prototype.isReady=function(){return b},g.prototype.clearMap=function(){context.fillStyle=d,context.strokeStyle=e;for(var a=canvas.width-c;a>=0;a--)for(var b=canvas.height-c;b>=0;b--)this.applyStyle(context,a,b)},g.prototype.showStartText=function(){context.font="bold 35px sans-serif",context.fillStyle="#FFFFFF",context.fillText("Press space bar to start!",canvas.width/4,canvas.height/2)},g.prototype.showScore=function(){context.font="bold 18px sans-serif",context.fillStyle="rgba(255, 255, 255, 0.3)",context.fillText("Score: "+f,canvas.width-120,canvas.height-20)},g.prototype.applyStyle=function(a,b,d){a.fillRect(b*c,d*c,c,c),a.lineWidth=.5,a.strokeRect(b*c,d*c,c,c)},g.prototype.addScore=function(){f++},g.prototype.resetScore=function(){f=0},g}(window),function(a){function b(){return{x:Math.floor(Math.random()*(canvas.width/game.blockSize())),y:Math.floor(Math.random()*(canvas.height/game.blockSize()))}}function c(a,b){var c=!0;return snake.forEachSegment(function(d){return d.x===a&&d.y===b?(c=!1,!0):void 0}),c}function d(){for(var a;;)if(a=b(),c(a.x,a.y)){i=a.x,j=a.y;break}}function e(){snake.forEachSegment(function(a){return i===a.x&&j===a.y?k=!0:void 0})}function f(){return context.fillStyle=g,context.strokeStyle=h,context}var g="#FF6363",h="#FFA8A8",i=null,j=null,k=!0,l=a.Food=function(){return!this instanceof arguments.callee?new l:void 0};return l.prototype.consumed=function(){return k},l.prototype.draw=function(){e(),k&&(game.addScore(),d(),k=!1,snake.grow()),game.applyStyle(f(),i,j)},l.prototype.init=function(){k&&(d(),k=!1),game.applyStyle(context,i,j)},l}(window),function(a){function b(){return g[0]}function c(a){context.fillStyle=j,context.strokeStyle=k,game.applyStyle(context,a.x,a.y)}function d(a,b){switch(b=b||function(){},a){case 37:39!=h&&b(a,-1,0);break;case 38:40!==h&&b(a,0,-1);break;case 39:37!==h&&b(a,1,0);break;case 40:38!==h&&b(a,0,1)}}function e(){var a=b().x,c=b().y;return d(i,function(b,d,e){h=b,a+=d,c+=e}),{x:a,y:c}}var f=5,g=[],h=39,i=39,j="#FFFFFF",k="#D1D1D1",l=!1,m=a.Snake=function(){return!this instanceof arguments.callee?new m:void 0};return m.prototype.collided=function(){var a=e(),b=!1;return this.forEachSegment(function(c){return a.x===c.x&&a.y===c.y?(b=!0,!0):void 0}),(a.x*game.blockSize()>canvas.width-game.blockSize()||a.x<0)&&(b=!0),(a.y*game.blockSize()>canvas.height-game.blockSize()||a.y<0)&&(b=!0),b},m.prototype.draw=function(){this.forEachSegment(c)},m.prototype.forEachSegment=function(a){if(a&&1==a.length)for(var b=g.length-1;b>=0&&!a(g[b]);b--);},m.prototype.init=function(){g=[],h=39,i=39;for(var a=f-1;a>=0;a--)g.push({x:a,y:0})},m.prototype.grow=function(){l=!0},m.prototype.segments=function(){return g},m.prototype.setDirection=function(a){d(a,function(a){i=a})},m.prototype.update=function(){var a=e();if(l)g.unshift(a),l=!1;else{var b=g.pop();b.x=a.x,b.y=a.y,g.unshift(b)}},m}(window);var canvas=function(){var a=document.createElement("canvas");return a.width=800,a.height=600,document.body.appendChild(a),a}(),context=canvas.getContext("2d"),game=new Game,snake=new Snake,food=new Food,registerKeyListeners=function(){document.addEventListener("keydown",function(a){32===a.keyCode&&game.start(),snake.setDirection(a.keyCode)},!1)},gameLoop=function(){setTimeout(function(){requestAnimationFrame(gameLoop);game.clearMap(),game.isReady()?snake.collided()?(game.pause(),game.resetScore()):(snake.update(),snake.draw(),food.draw()):(snake.init(),snake.draw(),food.init(),game.showStartText()),game.showScore()},1e3/game.FPS)};registerKeyListeners(),gameLoop();